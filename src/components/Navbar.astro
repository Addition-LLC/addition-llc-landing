---
// FIX: Added "Case Studies" to the menu.
const menuItems = [
  { href: '/about', label: 'About us' },
  { href: '/#services', label: 'Services' },
  { href: '/#projects', label: 'Case Studies' },
  { href: '/#team', label: 'Team' },
  { href: '/articles', label: 'Blog'},
  { href: '/#contact', label: 'Contact' },
];

const navButton = { href: '/requestQuote', label: 'Request a quote' };
---

<header id="main-header" class="fixed top-0 left-0 z-50 w-full p-4 transition-all duration-300 ease-in-out">
  <div id="nav-content" class="mx-auto flex items-center justify-between transition-all duration-300 ease-in-out px-8 py-4 max-w-7xl">
    
    <a href="/" class="flex-shrink-0 z-10">
      <img src="/Logo.svg" class="h-8 w-auto" alt="Addition+ Logo" />
    </a>

    <nav id="desktop-nav" class="hidden lg:flex items-center justify-center absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
      <div id="nav-indicator" class="absolute h-10 bg-blue-100 dark:bg-slate-700 rounded-full transition-all duration-300 ease-out"></div>
      {menuItems.map(item => (
        // FIX: Replaced 'text-slate-800' with 'text-stone' and 'dark:text-slate-200' with 'dark:text-white'
        <a href={item.href} class="nav-link relative z-10 px-5 py-2 text-sm font-semibold leading-6 text-stone hover:text-blue-600 dark:text-white dark:hover:text-blue-300 transition-colors duration-200">
          {item.label}
        </a>
      ))}
    </nav>

    <div class="hidden lg:flex items-center gap-x-5 z-10">
      <button id="theme-toggle" type="button" class="h-10 w-10 flex items-center justify-center rounded-full text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
        <span class="sr-only">Toggle theme</span>
        <svg id="theme-icon-light" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.95-4.243l-1.59-1.591M5.25 12H3m4.243-4.95l-1.59-1.591M12 9a3 3 0 100 6 3 3 0 000-6z" /></svg>
        <svg id="theme-icon-dark" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
      </button>

      <a 
        href={navButton.href} 
        class="rounded-full bg-blue-600 px-6 py-2.5 text-sm font-semibold text-white shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition-all hover:scale-105"
      >
        {navButton.label}
      </a>
    </div>

    <div class="flex items-center gap-x-2 lg:hidden z-10">
      <button id="theme-toggle-mobile" type="button" class="h-10 w-10 flex items-center justify-center rounded-full text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
        <span class="sr-only">Toggle theme</span>
        <svg id="theme-icon-light-mobile" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.95-4.243l-1.59-1.591M5.25 12H3m4.243-4.95l-1.59-1.591M12 9a3 3 0 100 6 3 3 0 000-6z" /></svg>
        <svg id="theme-icon-dark-mobile" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
      </button>

      <button id="menu-toggle" type="button" class="inline-flex items-center justify-center rounded-md text-stone dark:text-white h-10 w-10">
        <span class="sr-only">Open main menu</span>
        <div class="space-y-1.5">
          <span class="block w-6 h-0.5 bg-stone dark:bg-white transition-all duration-300 ease-out"></span>
          <span class="block w-6 h-0.5 bg-stone dark:bg-white transition-all duration-300 ease-out"></span>
          <span class="block w-4 h-0.5 bg-stone dark:bg-white transition-all duration-300 ease-out"></span>
        </div>
      </button>
    </div>

  </div>

  <div id="mobile-menu" class="fixed inset-0 z-40 hidden" role="dialog" aria-modal="true">
    <div id="mobile-menu-backdrop" class="fixed inset-0 bg-black/30 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
    <div id="mobile-menu-panel" class="fixed inset-y-0 right-0 z-50 w-full max-w-sm bg-white dark:bg-slate-900 p-6 transition-transform duration-300 translate-x-full">
      <div class="flex items-center justify-between">
        <a href="/">
          <img class="h-8 w-auto" src="/Logo.svg" alt="Addition+ Logo">
        </a>
        <button id="menu-close" type="button" class="-m-2.5 rounded-md p-2.5 text-gray-700 dark:text-gray-300">
          <span class="sr-only">Close menu</span>
          <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
      <div class="mt-8 flow-root">
        <div class="-my-6 divide-y divide-gray-500/10 dark:divide-gray-200/10">
          <div class="space-y-2 py-6">
            {menuItems.map(item => (
              <a href={item.href} class="nav-link -mx-3 block rounded-lg px-3 py-3 text-base font-semibold leading-7 text-stone dark:text-white hover:bg-gray-50 dark:hover:bg-gray-800">{item.label}</a>
            ))}
          </div>
          <div class="py-6">
            <a href={navButton.href} class="-mx-3 block rounded-lg px-3 py-4 text-base font-semibold leading-7 text-stone dark:text-white hover:bg-gray-50 dark:hover:bg-gray-800">{navButton.label}</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Theme toggle functionality ---
    const themeToggles = document.querySelectorAll('#theme-toggle, #theme-toggle-mobile');
    const lightIcons = document.querySelectorAll('#theme-icon-light, #theme-icon-light-mobile');
    const darkIcons = document.querySelectorAll('#theme-icon-dark, #theme-icon-dark-mobile');

    const updateIcons = (theme: string) => {
        lightIcons.forEach(icon => icon.classList.toggle('hidden', theme === 'dark'));
        darkIcons.forEach(icon => icon.classList.toggle('hidden', theme === 'light'));
    };
    
    const toggleTheme = () => {
        const isDark = document.documentElement.classList.toggle('dark');
        const newTheme = isDark ? 'dark' : 'light';
        localStorage.setItem('theme', newTheme);
        updateIcons(newTheme);
    };

    themeToggles.forEach(btn => btn.addEventListener('click', toggleTheme));

    const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    updateIcons(currentTheme);

  const header = document.getElementById('main-header');
  const navContent = document.getElementById('nav-content');

  if (header && navContent) {
    const handleScroll = () => {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    };
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
  }

  const desktopNav = document.getElementById('desktop-nav');
  const navIndicator = document.getElementById('nav-indicator') as HTMLElement | null;
  const navLinks = document.querySelectorAll('.nav-link');

  if (desktopNav && navIndicator && navLinks.length > 0) {
    const handleNavLinkHover = (e: MouseEvent) => {
      const link = e.currentTarget as HTMLElement;
      if (navIndicator) {
        navIndicator.style.width = `${link.offsetWidth}px`;
        navIndicator.style.left = `${link.offsetLeft}px`;
        navIndicator.style.opacity = '1';
      }
    };

    const handleNavMouseLeave = () => {
      if (navIndicator) {
        navIndicator.style.opacity = '0';
      }
    };

    navLinks.forEach(link => {
      link.addEventListener('mouseenter', handleNavLinkHover as EventListener);
    });

    desktopNav.addEventListener('mouseleave', handleNavMouseLeave);
  }

  const menuToggle = document.getElementById('menu-toggle');
  const menuClose = document.getElementById('menu-close');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop') as HTMLElement | null;
  const mobileMenuPanel = document.getElementById('mobile-menu-panel') as HTMLElement | null;

  const openMenu = () => {
    if (mobileMenu) mobileMenu.classList.remove('hidden');
    if (menuToggle) menuToggle.classList.add('is-open');
    setTimeout(() => {
        if (mobileMenuBackdrop) mobileMenuBackdrop.style.opacity = '1';
        if (mobileMenuPanel) mobileMenuPanel.style.transform = 'translateX(0)';
    }, 10);
  };
  
  const closeMenu = () => {
    if (menuToggle) menuToggle.classList.remove('is-open');
    if (mobileMenuBackdrop) mobileMenuBackdrop.style.opacity = '0';
    if (mobileMenuPanel) mobileMenuPanel.style.transform = 'translateX(100%)';
    setTimeout(() => {
        if (mobileMenu) mobileMenu.classList.add('hidden');
    }, 300);
  };

  if (menuToggle && mobileMenu && menuClose && mobileMenuPanel && mobileMenuBackdrop) {
    menuToggle.addEventListener('click', openMenu);
    menuClose.addEventListener('click', closeMenu);
    mobileMenuBackdrop.addEventListener('click', closeMenu);
  }

  // --- FINAL FIX: Robust smooth-scroll functionality that prevents scroll-locking ---
  const allNavLinks = document.querySelectorAll('a.nav-link');
  allNavLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      const anchor = link as HTMLAnchorElement;
      const href = anchor.getAttribute('href');

      // Check if it's an in-page hash link for the homepage (e.g., '/#services')
      if (href && href.startsWith('/#')) {
        // If we are already on the homepage, handle the smooth scroll
        if (window.location.pathname === '/') {
            e.preventDefault(); // This is the key: stop the browser's default jump
            
            const targetId = href.substring(2);
            const targetElement = document.getElementById(targetId);

            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start' // Aligns the top of the element to the top of the viewport
                });
            }
        }
        // If on another page (e.g., /about), the link will navigate to the homepage
        // and the browser will handle jumping to the hash.
      }
      
      // For all link clicks, close the mobile menu if it's open
      if (!mobileMenu?.classList.contains('hidden')) {
        closeMenu();
      }
    });
  });
});
</script>

<style>
  #main-header.scrolled #nav-content {
    max-width: 80rem;
    background-color: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(16px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 9999px;
  }

  .dark #main-header.scrolled #nav-content {
    background-color: rgba(30, 41, 59, 0.75);
    border-color: rgba(51, 65, 85, 0.5);
  }

  #nav-indicator {
    opacity: 0;
    pointer-events: none;
  }

  #menu-toggle.is-open span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }
  
  #menu-toggle.is-open span:nth-child(2) {
    opacity: 0;
  }
  
  #menu-toggle.is-open span:nth-child(3) {
    width: 1.5rem; /* 24px */
    transform: translateY(-8px) rotate(-45deg);
  }
</style>

